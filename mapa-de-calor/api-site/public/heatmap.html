<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="./js/heatmap.js"></script>
        <title>Document</title>
        <style>
        .heatmap{
            height: 490px;
            width: 850px;
            background-image: url("planta.png");
            background-size: cover;
        }
    </style>
        
    </head>

    <body>

        <div class="heatmap"></div>

        <form id="heatmap_form">
            <input id="hora_ini" type="time" name="hora_ini" min="00:00" max="23:59" required>
            <input id="hora_fim" type="time" name="hora_fim" min="00:00" max="23:59" required>          
        </form>
        <button type="submit" onclick="buscarPresencas()">Buscar</button>
    </body>
</html>

<script>
    

        // heatmapInstance.addData({ x: 10, y: 10, value: 100})

        function buscarPresencas() {
            var hora_iniVar = hora_ini.value;
            var hora_fimVar = hora_fim.value;
            
            var formulario = new URLSearchParams(new FormData(heatmap_form));
            fetch("medidas/presenca-hora", {
                method: "POST",
                headers: {
                "Content-Type": "application/json"
            },
                body: JSON.stringify({
                hora_ini: hora_iniVar,
                hora_fim: hora_fimVar,
            })
            }).then((resultado) => {
                if(resultado.ok) {
                    resultado.json().then((json) => {
                        console.log("JSON AQUI", json);

// Configuração mínima, container padrão
var heatmapInstance = h337.create({
        container: document.querySelector(".heatmap"),
    });

 
        var points = [];
        var max = 100;
        var min = 0;
        var width = 850;
        var height = 490;

        //Gerando um ponto por local da planta
        var local1 = {x: 130, y:150, value: json[0].total, radius: 150,};
        var local2 = {x: 350, y:110, value: json[1].total, radius: 120,};
        var local3 = {x: 750, y:130, value: json[2].total, radius: 130,};
        var local4 = {x: 150, y:380, value: json[3].total, radius: 100,};
        var local5 = {x: 450, y:370, value: json[4].total, radius: 150,};
        var local6 = {x: 700, y:380, value: json[5].total, radius: 180,};


        console.log("Local 1:", local1);
        console.log("Local 2:", local2);
        console.log("Local 3:", local3);
        console.log("Local 4:", local4);
        console.log("Local 5:", local5);
        console.log("Local 6:", local6);

        points = points.concat(local1, local2, local3, local4, local5, local6);


        //formato para gerar mapa
        var data = {
            max: max,
            min: min,
            data: points,
        };

        //inicia pontos no mapa de calor
        heatmapInstance.setData(data);
                    });
                } else {
                    console.log("Erro ao buscar quantidade de presença!");

                    // response.text().then((texto) => {
                    //     console.error(texto);
                    // })
                }
            });
            return false;
        }
  
</script>